<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="#{page.title.warehouse}">仓库管理 - WMS管理中心</title>
    <link rel="icon" th:href="@{/images/favicon.svg}" type="image/ico">
    <link rel="stylesheet" th:href="@{/css/materialdesignicons.min.css}">
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/css/style.min.css}">
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background-color: #f5f5f5;
        }

        .warehouse-container {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
            margin-top: 15px;
        }

        .warehouse-selector {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .warehouse-columns {
            display: flex;
            flex-wrap: nowrap;
            overflow-x: auto;
            padding-bottom: 15px;
            gap: 15px;
        }

        .warehouse-column {
            display: flex;
            flex-direction: column;
            min-width: 100px;
            background-color: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 10px 8px;
            position: relative;
        }

        .column-header {
            text-align: center;
            font-weight: bold;
            font-size: 14px;
            color: #495057;
            margin-bottom: 10px;
            padding: 5px;
            background-color: #e9ecef;
            border-radius: 4px;
        }

        .position-btn {
            width: 80px;
            height: 50px;
            margin: 3px auto;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 11px;
            transition: all 0.3s;
            border: 1px solid #dee2e6;
            cursor: pointer;
            text-align: center;
            line-height: 1.2;
            padding: 2px;
            word-break: break-all;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .position-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .position-available {
            background-color: #28a745;
            color: white;
        }

        .position-occupied {
            background-color: #ffc107;
            color: #212529;
        }

        .position-disabled {
            background-color: #6c757d;
            color: white;
        }

        .position-empty {
            background-color: #e9ecef;
            color: #6c757d;
            border-style: dashed;
        }

        /* 批量选择相关样式 */
        .position-btn.batch-mode {
            cursor: pointer;
            position: relative;
        }

        .position-btn.batch-mode:hover {
            box-shadow: 0 0 10px rgba(0,123,255,0.5);
        }

        .position-btn.selected {
            border: 3px solid #007bff !important;
            box-shadow: 0 0 10px rgba(0,123,255,0.8);
        }

        .position-btn.selected::after {
            content: '✓';
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #007bff;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        .batch-operation-panel {
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .selected-positions-preview {
            max-height: 200px;
            overflow-y: auto;
        }

        .position-preview-item {
            display: inline-block;
            margin: 2px;
            padding: 4px 8px;
            background-color: #007bff;
            color: white;
            border-radius: 12px;
            font-size: 12px;
        }

        .usage-stats {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            margin-bottom: 20px;
        }

        .usage-percent {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
        }

        .usage-label {
            font-size: 12px;
            color: #6c757d;
        }

        .detailed-stats {
            font-size: 12px;
        }

        .stat-item {
            margin-bottom: 5px;
        }

        .stat-number {
            font-size: 16px;
            font-weight: bold;
            line-height: 1;
        }

        .stat-label {
            font-size: 10px;
            color: #6c757d;
            line-height: 1;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
        }

        .legend-color {
            width: 20px;
            height: 15px;
            border-radius: 3px;
            border: 1px solid #dee2e6;
        }

        .management-panel {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }

        .btn-management {
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .warehouse-info {
            background-color: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 0 8px 8px 0;
        }

        @media (max-width: 768px) {
            .warehouse-columns {
                gap: 8px;
            }

            .warehouse-column {
                min-width: 85px;
            }

            .position-btn {
                width: 70px;
                height: 45px;
                font-size: 10px;
            }
        }

        /* 超长文本处理 */
        .position-btn.long-text {
            font-size: 9px;
            line-height: 1.1;
            white-space: normal;
            word-wrap: break-word;
            hyphens: auto;
        }


    </style>
</head>
<body>
<div class="hx-layout-web">
    <!--左侧导航-->
    <div th:replace="~{navbar :: sidebar}"></div>

    <!-- 页面主要内容 -->
    <main class="hx-layout-content">
        <div class="container-fluid">
            <!-- 管理面板 -->
            <div class="management-panel">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 class="mb-0"><i class="mdi mdi-warehouse"></i> <span th:text="#{nav.warehouse.visualization}">仓库可视化管理</span></h4>
                    <div>
                        <button class="btn btn-success btn-management" onclick="showAddWarehouseModal()">
                            <i class="mdi mdi-plus"></i> <span th:text="#{btn.add.warehouse}">添加仓库</span>
                        </button>
                        <button class="btn btn-primary btn-management" onclick="showManagementView()">
                            <i class="mdi mdi-table"></i> <span th:text="#{btn.management.view}">管理视图</span>
                        </button>
                        <button class="btn btn-info btn-management" onclick="refreshData()">
                            <i class="mdi mdi-refresh"></i> <span th:text="#{btn.refresh}">刷新</span>
                        </button>
                    </div>
                </div>

                <!-- 仓库选择器 -->
                <div class="warehouse-selector">
                    <div class="row align-items-center">
                        <div class="col-md-4">
                            <label for="warehouseSelect" class="form-label"><strong th:text="#{form.label.select.warehouse}">选择仓库：</strong></label>
                            <select class="form-control" id="warehouseSelect" onchange="switchWarehouse()">
                                <option value="" th:text="#{placeholder.select.warehouse}">请选择仓库</option>
                            </select>
                        </div>
                        <div class="col-md-8">
                            <div class="warehouse-info" id="warehouseInfo" style="display: none;">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h6 class="mb-1" id="warehouseTitle" th:text="#{warehouse.info.title}">仓库信息</h6>
                                        <p class="mb-0 text-muted" id="warehouseDesc" th:text="#{warehouse.info.description}">仓库描述</p>
                                    </div>
                                    <div class="col-md-3 text-center">
                                        <div class="usage-stats">
                                            <div class="usage-percent" id="usagePercent">0%</div>
                                            <div class="usage-label" th:text="#{usage.rate.label}">库位使用率</div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div id="detailedStats" class="detailed-stats">
                                            <!-- 详细统计信息将通过JavaScript动态填充 -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 可视化仓库展示 -->
            <div class="warehouse-container" id="warehouseVisualization" style="display: none;">
                <!-- 批量操作控制区域 -->
                <div class="batch-operation-panel" style="background-color: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; display: none;" id="batchOperationPanel">
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="mb-2"><i class="mdi mdi-checkbox-multiple-marked"></i> <span th:text="#{batch.operation.title}">批量操作</span></h6>
                            <p class="text-muted mb-0"><span th:text="#{batch.selected.prefix}">已选择</span> <span id="selectedCount">0</span> <span th:text="#{batch.selected.suffix}">个点位</span></p>
                        </div>
                        <div class="col-md-6 text-right">
                            <div class="btn-group">
                                <button class="btn btn-success btn-sm" onclick="batchUpdateStatus(1)">
                                    <i class="mdi mdi-check-circle"></i> <span th:text="#{btn.set.available}">设为可用</span>
                                </button>
                                <button class="btn btn-warning btn-sm" onclick="batchUpdateStatus(2)">
                                    <i class="mdi mdi-alert-circle"></i> <span th:text="#{btn.set.occupied}">设为占用</span>
                                </button>
                                <button class="btn btn-secondary btn-sm" onclick="batchUpdateStatus(3)">
                                    <i class="mdi mdi-cancel"></i> <span th:text="#{btn.set.disabled}">设为禁用</span>
                                </button>
                                <button class="btn btn-outline-secondary btn-sm" onclick="clearSelection()">
                                    <i class="mdi mdi-close"></i> <span th:text="#{btn.clear.selection}">清除选择</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 图例和操作按钮 -->
                <div class="legend-and-controls" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color position-available"></div>
                            <span th:text="#{legend.available}">可用</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color position-occupied"></div>
                            <span th:text="#{legend.occupied}">占用</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color position-disabled"></div>
                            <span th:text="#{legend.disabled}">禁用</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color position-empty"></div>
                            <span th:text="#{legend.empty}">空位</span>
                        </div>
                    </div>

                    <div class="batch-controls">
                        <button class="btn btn-primary btn-sm" onclick="toggleBatchMode()" id="batchModeBtn">
                            <i class="mdi mdi-checkbox-multiple-marked"></i> <span th:text="#{btn.batch.select}">批量选择</span>
                        </button>
                        <button class="btn btn-outline-primary btn-sm" onclick="selectAllPositions()">
                            <i class="mdi mdi-select-all"></i> <span th:text="#{btn.select.all}">全选</span>
                        </button>
                    </div>
                </div>

                <!-- 库位列可视化展示 -->
                <div id="warehouseGrid" class="warehouse-columns">
                    <!-- 库位列将通过JavaScript动态生成 -->
                </div>

                <!-- 操作提示 -->
                <div class="mt-3 text-center text-muted">
                    <small>
                        <i class="mdi mdi-information"></i>
                        <span th:text="#{operation.tip}">点击库位方块可查看详细信息，右键可进行操作管理</span>
                    </small>
                </div>
            </div>

            <!-- 传统表格视图（隐藏） -->
            <div id="managementView" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h4 class="card-title" th:text="#{nav.warehouse.visualization}">仓库管理</h4>
                    </div>
                    <div class="card-toolbar clearfix">
                        <!-- 搜索框 -->
                        <form class="pull-right search-bar" id="searchForm" role="form">
                            <div class="input-group">
                                <input class="form-control" id="searchInput" name="search"
                                       th:placeholder="#{placeholder.search.warehouse.name}" placeholder="搜索仓库名称" type="text">
                                <div class="input-group-btn">
                                    <button class="btn btn-primary" onclick="searchWarehouses()" type="button">
                                        <i class="mdi mdi-magnify"></i> <span th:text="#{btn.search}">搜索</span>
                                    </button>
                                </div>
                            </div>
                        </form>

                        <!-- 操作按钮区域 -->
                        <div class="pull-left">
                            <button class="btn btn-primary" onclick="showVisualizationView()">
                                <i class="mdi mdi-eye"></i> <span th:text="#{btn.visualization.view}">可视化视图</span>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-bordered table-hover">
                                <thead class="thead-light">
                                <tr>
                                    <th width="50"><i class="mdi mdi-chevron-right"></i></th>
                                    <th th:text="#{table.header.warehouse.name}">仓库名称</th>
                                    <th th:text="#{table.header.description}">描述</th>
                                    <th width="100" th:text="#{table.header.column.count}">库位列数</th>
                                    <th width="200" th:text="#{table.header.operations}">操作</th>
                                </tr>
                                </thead>
                                <tbody id="warehouseTable">
                                <!-- 数据将通过AJAX动态加载 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<!-- 添加仓库模态框 -->
<div aria-hidden="true" aria-labelledby="addWarehouseModalLabel" class="modal fade" id="addWarehouseModal" role="dialog"
     tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title"><i class="mdi mdi-plus"></i> <span th:text="#{modal.title.add.warehouse}">添加仓库</span></h4>
            </div>
            <div class="modal-body">
                <form id="addWarehouseForm">
                    <div class="form-group">
                        <label for="warehouseName"><span th:text="#{form.label.warehouse.name}">仓库名称</span> <span class="text-danger">*</span></label>
                        <input class="form-control" id="warehouseName" name="warehouseName"
                               th:placeholder="#{placeholder.enter.warehouse.name}" placeholder="请输入仓库名称" required type="text">
                    </div>
                    <div class="form-group">
                        <label for="description" th:text="#{form.label.warehouse.description}">仓库描述</label>
                        <textarea class="form-control" id="description" name="description"
                                  th:placeholder="#{placeholder.enter.warehouse.description}" placeholder="请输入仓库描述" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal" type="button" th:text="#{btn.cancel}">取消</button>
                <button class="btn btn-primary" onclick="addWarehouse()" type="button" th:text="#{btn.add}">添加</button>
            </div>
        </div>
    </div>
</div>

<!-- 编辑仓库模态框 -->
<div aria-hidden="true" aria-labelledby="editWarehouseModalLabel" class="modal fade" id="editWarehouseModal" role="dialog"
     tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title"><i class="mdi mdi-pencil"></i> <span th:text="#{modal.title.edit.warehouse}">编辑仓库</span></h4>
            </div>
            <div class="modal-body">
                <form id="editWarehouseForm">
                    <input id="editWarehouseId" name="warehouseId" type="hidden">
                    <div class="form-group">
                        <label for="editWarehouseName"><span th:text="#{form.label.warehouse.name}">仓库名称</span> <span class="text-danger">*</span></label>
                        <input class="form-control" id="editWarehouseName" name="warehouseName"
                               th:placeholder="#{placeholder.enter.warehouse.name}" placeholder="请输入仓库名称" required type="text">
                    </div>
                    <div class="form-group">
                        <label for="editDescription" th:text="#{form.label.warehouse.description}">仓库描述</label>
                        <textarea class="form-control" id="editDescription" name="description"
                                  th:placeholder="#{placeholder.enter.warehouse.description}" placeholder="请输入仓库描述" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal" type="button" th:text="#{btn.cancel}">取消</button>
                <button class="btn btn-primary" onclick="updateWarehouse()" type="button" th:text="#{btn.save}">保存</button>
            </div>
        </div>
    </div>
</div>

<!-- 添加库位列模态框 -->
<div aria-hidden="true" aria-labelledby="addColumnModalLabel" class="modal fade" id="addColumnModal" role="dialog"
     tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title"><i class="mdi mdi-plus"></i> <span th:text="#{modal.title.add.column}">添加库位列</span></h4>
            </div>
            <div class="modal-body">
                <form id="addColumnForm">
                    <input id="columnWarehouseId" name="warehouseId" type="hidden">
                    <div class="form-group">
                        <label for="columnName"><span th:text="#{form.label.column.name}">库位列名称</span> <span class="text-danger">*</span></label>
                        <input class="form-control" id="columnName" name="columnName"
                               th:placeholder="#{placeholder.enter.column.name}" placeholder="请输入库位列名称" required type="text">
                    </div>
                    <div class="form-group">
                        <label for="columnOrder"><span th:text="#{form.label.column.order}">排序</span> <span class="text-danger">*</span></label>
                        <input class="form-control" id="columnOrder" name="columnOrder"
                               th:placeholder="#{placeholder.enter.order.number}" placeholder="请输入排序号" required type="number" min="1">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal" type="button" th:text="#{btn.cancel}">取消</button>
                <button class="btn btn-primary" onclick="addWarehouseColumn()" type="button" th:text="#{btn.add}">添加</button>
            </div>
        </div>
    </div>
</div>

<!-- 编辑库位列模态框 -->
<div aria-hidden="true" aria-labelledby="editColumnModalLabel" class="modal fade" id="editColumnModal" role="dialog"
     tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title"><i class="mdi mdi-pencil"></i> <span th:text="#{modal.title.edit.column}">编辑库位列</span></h4>
            </div>
            <div class="modal-body">
                <form id="editColumnForm">
                    <input id="editColumnId" name="columnId" type="hidden">
                    <input id="editColumnWarehouseId" name="warehouseId" type="hidden">
                    <div class="form-group">
                        <label for="editColumnName"><span th:text="#{form.label.column.name}">库位列名称</span> <span class="text-danger">*</span></label>
                        <input class="form-control" id="editColumnName" name="columnName"
                               th:placeholder="#{placeholder.enter.column.name}" placeholder="请输入库位列名称" required type="text">
                    </div>
                    <div class="form-group">
                        <label for="editColumnOrder"><span th:text="#{form.label.column.order}">排序</span> <span class="text-danger">*</span></label>
                        <input class="form-control" id="editColumnOrder" name="columnOrder"
                               th:placeholder="#{placeholder.enter.order.number}" placeholder="请输入排序号" required type="number" min="1">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal" type="button" th:text="#{btn.cancel}">取消</button>
                <button class="btn btn-primary" onclick="updateWarehouseColumn()" type="button" th:text="#{btn.save}">保存</button>
            </div>
        </div>
    </div>
</div>

<!-- 添加点位关联模态框 -->
<div aria-hidden="true" aria-labelledby="addVertexesModalLabel" class="modal fade" id="addVertexesModal" role="dialog"
     tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title"><i class="mdi mdi-plus"></i> <span th:text="#{modal.title.add.position.association}">添加点位关联</span></h4>
            </div>
            <div class="modal-body">
                <!-- 错误提示区域 -->
                <div id="addVertexesError" class="alert alert-danger" style="display: none;" role="alert">
                    <h6 class="alert-heading"><i class="mdi mdi-alert-circle"></i> <span th:text="#{error.binding.failed}">绑定失败</span></h6>
                    <p class="mb-0" id="addVertexesErrorMessage"></p>
                    <hr>
                    <p class="mb-0 small">
                        <i class="mdi mdi-information"></i>
                        <span th:text="#{error.binding.tip}">请选择其他未绑定的点位，或先解除现有绑定关系。</span>
                    </p>
                </div>

                <form id="addVertexesForm">
                    <input id="vertexesColumnId" name="columnId" type="hidden">
                    <div class="form-group">
                        <label for="mapIdSelect"><span th:text="#{form.label.select.map}">选择地图</span> <span class="text-danger">*</span></label>
                        <select class="form-control" id="mapIdSelect" name="mapId" required onchange="loadVertexesByMap()">
                            <option value="" th:text="#{placeholder.select.map}">请选择地图</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="mapVertexSelect"><span th:text="#{form.label.select.map.position}">选择地图点位</span> <span class="text-danger">*</span></label>
                        <select class="form-control" id="mapVertexSelect" name="hxMapVertexesId" required>
                            <option value="" th:text="#{placeholder.select.map.first}">请先选择地图</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="positionOrder"><span th:text="#{form.label.position.order}">点位排序</span> <span class="text-danger">*</span></label>
                        <input class="form-control" id="positionOrder" name="positionOrder"
                               th:placeholder="#{placeholder.enter.order.number}" placeholder="请输入排序号" required type="number" min="1">
                    </div>
                    <div class="form-group">
                        <label for="positionStatus"><span th:text="#{form.label.status}">状态</span> <span class="text-danger">*</span></label>
                        <select class="form-control" id="positionStatus" name="status" required>
                            <option value="1" th:text="#{status.available}">可用</option>
                            <option value="2" th:text="#{status.occupied}">占用</option>
                            <option value="3" th:text="#{status.disabled}">禁用</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal" type="button" th:text="#{btn.cancel}">取消</button>
                <button class="btn btn-primary" onclick="addWarehouseVertexes()" type="button" th:text="#{btn.add}">添加</button>
            </div>
        </div>
    </div>
</div>

<!-- 编辑点位关联模态框 -->
<div aria-hidden="true" aria-labelledby="editVertexesModalLabel" class="modal fade" id="editVertexesModal" role="dialog"
     tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title"><i class="mdi mdi-pencil"></i> <span th:text="#{modal.title.edit.position.association}">编辑点位关联</span></h4>
            </div>
            <div class="modal-body">
                <!-- 错误提示区域 -->
                <div id="editVertexesError" class="alert alert-danger" style="display: none;" role="alert">
                    <h6 class="alert-heading"><i class="mdi mdi-alert-circle"></i> <span th:text="#{error.update.failed}">更新失败</span></h6>
                    <p class="mb-0" id="editVertexesErrorMessage"></p>
                    <hr>
                    <p class="mb-0 small">
                        <i class="mdi mdi-information"></i>
                        <span th:text="#{error.binding.tip}">请选择其他未绑定的点位，或先解除现有绑定关系。</span>
                    </p>
                </div>

                <form id="editVertexesForm">
                    <input id="editVertexesPositionId" name="positionId" type="hidden">
                    <input id="editVertexesColumnId" name="columnId" type="hidden">
                    <div class="form-group">
                        <label for="editMapIdSelect"><span th:text="#{form.label.select.map}">选择地图</span> <span class="text-danger">*</span></label>
                        <select class="form-control" id="editMapIdSelect" name="mapId" required onchange="loadVertexesByMapForEdit()">
                            <option value="" th:text="#{placeholder.select.map}">请选择地图</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editMapVertexSelect"><span th:text="#{form.label.select.map.position}">选择地图点位</span> <span class="text-danger">*</span></label>
                        <select class="form-control" id="editMapVertexSelect" name="hxMapVertexesId" required>
                            <option value="" th:text="#{placeholder.select.map.first}">请先选择地图</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editPositionOrder"><span th:text="#{form.label.position.order}">点位排序</span> <span class="text-danger">*</span></label>
                        <input class="form-control" id="editPositionOrder" name="positionOrder"
                               th:placeholder="#{placeholder.enter.order.number}" placeholder="请输入排序号" required type="number" min="1">
                    </div>
                    <div class="form-group">
                        <label for="editPositionStatus"><span th:text="#{form.label.status}">状态</span> <span class="text-danger">*</span></label>
                        <select class="form-control" id="editPositionStatus" name="status" required>
                            <option value="1" th:text="#{status.available}">可用</option>
                            <option value="2" th:text="#{status.occupied}">占用</option>
                            <option value="3" th:text="#{status.disabled}">禁用</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal" type="button" th:text="#{btn.cancel}">取消</button>
                <button class="btn btn-primary" onclick="updateWarehouseVertexes()" type="button" th:text="#{btn.save}">保存</button>
            </div>
        </div>
    </div>
</div>

<!-- 点位详情模态框 -->
<div aria-hidden="true" aria-labelledby="positionDetailModalLabel" class="modal fade" id="positionDetailModal" role="dialog"
     tabindex="-1">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title"><i class="mdi mdi-map-marker"></i> <span th:text="#{modal.title.position.detail}">点位详情</span></h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="mdi mdi-information"></i> <span th:text="#{detail.basic.info}">基本信息</span></h6>
                            </div>
                            <div class="card-body">
                                <table class="table table-borderless table-sm">
                                    <tr>
                                        <td><strong><span th:text="#{detail.association.id}">关联ID</span>:</strong></td>
                                        <td id="detailPositionId">-</td>
                                    </tr>
                                    <tr>
                                        <td><strong><span th:text="#{detail.order}">排序</span>:</strong></td>
                                        <td id="detailPositionOrder">-</td>
                                    </tr>
                                    <tr>
                                        <td><strong><span th:text="#{detail.status}">状态</span>:</strong></td>
                                        <td id="detailPositionStatus">-</td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="mdi mdi-map"></i> <span th:text="#{detail.map.position.info}">地图点位信息</span></h6>
                            </div>
                            <div class="card-body">
                                <table class="table table-borderless table-sm">
                                    <tr>
                                        <td><strong><span th:text="#{detail.position.code}">点位编码</span>:</strong></td>
                                        <td id="detailVertexCode">-</td>
                                    </tr>
                                    <tr>
                                        <td><strong><span th:text="#{detail.position.alias}">点位别名</span>:</strong></td>
                                        <td id="detailVertexAlias">-</td>
                                    </tr>
                                    <tr>
                                        <td><strong><span th:text="#{detail.coordinates}">坐标位置</span>:</strong></td>
                                        <td id="detailVertexCoords">-</td>
                                    </tr>
                                    <tr>
                                        <td><strong><span th:text="#{detail.angle}">角度</span>:</strong></td>
                                        <td id="detailVertexTheta">-</td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="mdi mdi-warehouse"></i> <span th:text="#{detail.belonging.info}">所属信息</span></h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-4">
                                        <strong><span th:text="#{detail.belonging.warehouse}">所属仓库</span>:</strong>
                                        <p id="detailWarehouseName" class="text-primary">-</p>
                                    </div>
                                    <div class="col-md-4">
                                        <strong><span th:text="#{detail.belonging.column}">所属库位列</span>:</strong>
                                        <p id="detailColumnName" class="text-info">-</p>
                                    </div>
                                    <div class="col-md-4">
                                        <strong><span th:text="#{detail.create.time}">创建时间</span>:</strong>
                                        <p id="detailCreateTime" class="text-muted">-</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal" type="button" th:text="#{btn.close}">关闭</button>
                <button class="btn btn-warning" id="editPositionBtn" type="button">
                    <i class="mdi mdi-pencil"></i> <span th:text="#{btn.edit}">编辑</span>
                </button>
                <button class="btn btn-danger" id="deletePositionBtn" type="button">
                    <i class="mdi mdi-delete"></i> <span th:text="#{btn.delete}">删除</span>
                </button>
            </div>
        </div>
    </div>
</div>



<script th:src="@{/js/jquery.min.js}"></script>
<script th:src="@{/js/bootstrap.min.js}"></script>
<script th:src="@{/js/perfect-scrollbar.min.js}"></script>
<script th:src="@{/js/main.min.js}"></script>
<script th:src="@{/js/bootstrap-notify.min.js}"></script>
<script th:inline="javascript">
    // I18n messages for JavaScript
    window.warehouseI18n = {
        loading: [[#{js.loading}]],
        noData: [[#{js.no.data}]],
        requestFailed: [[#{js.request.failed}]],
        serverError: [[#{js.server.error}]],
        available: [[#{status.available}]],
        occupied: [[#{status.occupied}]],
        disabled: [[#{status.disabled}]],
        yes: [[#{js.yes}]],
        no: [[#{js.no}]],
        edit: [[#{btn.edit}]],
        delete: [[#{btn.delete}]],
        close: [[#{btn.close}]],
        warehouseInfo: [[#{warehouse.info.title}]],
        warehouseDescription: [[#{warehouse.info.description}]],
        batchSelectedCount: [[#{batch.selected.count}]],
        // Warehouse specific messages
        warehouseLoading: [[#{js.warehouse.loading}]],
        warehouseNoData: [[#{js.warehouse.no.data}]],
        warehouseRequestFailed: [[#{js.warehouse.request.failed}]],
        warehouseServerError: [[#{js.warehouse.server.error}]],
        getDataFailed: [[#{js.warehouse.get.data.failed}]],
        noWarehouseData: [[#{js.warehouse.no.warehouse.data}]],
        noDescription: [[#{js.warehouse.no.description}]],
        columnName: [[#{js.warehouse.column.name}]],
        order: [[#{js.warehouse.order}]],
        positionCount: [[#{js.warehouse.position.count}]],
        clickToLoadColumns: [[#{js.warehouse.click.to.load.columns}]],
        noColumnData: [[#{js.warehouse.no.column.data}]],
        getColumnDataFailed: [[#{js.warehouse.get.column.data.failed}]],
        positionOrder: [[#{js.warehouse.position.order}]],
        positionCode: [[#{js.warehouse.position.code}]],
        positionAlias: [[#{js.warehouse.position.alias}]],
        coordinates: [[#{js.warehouse.coordinates}]],
        clickToLoadPositions: [[#{js.warehouse.click.to.load.positions}]],
        noPositionData: [[#{js.warehouse.no.position.data}]],
        getPositionDataFailed: [[#{js.warehouse.get.position.data.failed}]],
        noAlias: [[#{js.warehouse.no.alias}]],
        fillRequiredFields: [[#{js.warehouse.fill.required.fields}]],
        addWarehouseSuccess: [[#{js.warehouse.add.warehouse.success}]],
        addWarehouseFailed: [[#{js.warehouse.add.warehouse.failed}]],
        getWarehouseInfoFailed: [[#{js.warehouse.get.warehouse.info.failed}]],
        updateWarehouseSuccess: [[#{js.warehouse.update.warehouse.success}]],
        updateWarehouseFailed: [[#{js.warehouse.update.warehouse.failed}]],
        deleteWarehouseConfirm: [[#{js.warehouse.delete.warehouse.confirm}]],
        deleteWarehouseSuccess: [[#{js.warehouse.delete.warehouse.success}]],
        deleteWarehouseFailed: [[#{js.warehouse.delete.warehouse.failed}]],
        dataRefreshed: [[#{js.warehouse.data.refreshed}]],
        addColumnSuccess: [[#{js.warehouse.add.column.success}]],
        addColumnFailed: [[#{js.warehouse.add.column.failed}]],
        getColumnInfoFailed: [[#{js.warehouse.get.column.info.failed}]],
        updateColumnSuccess: [[#{js.warehouse.update.column.success}]],
        updateColumnFailed: [[#{js.warehouse.update.column.failed}]],
        getMapListFailed: [[#{js.warehouse.get.map.list.failed}]],
        selectMapFirst: [[#{js.warehouse.select.map.first}]],
        mapIdPrefix: [[#{js.warehouse.map.id.prefix}]],
        selectMapPosition: [[#{js.warehouse.select.map.position}]],
        noPositionsInMap: [[#{js.warehouse.no.positions.in.map}]],
        getMapPositionsFailed: [[#{js.warehouse.get.map.positions.failed}]],
        addPositionAssociationSuccess: [[#{js.warehouse.add.position.association.success}]],
        updatePositionAssociationSuccess: [[#{js.warehouse.update.position.association.success}]],
        updatePositionAssociationFailed: [[#{js.warehouse.update.position.association.failed}]],
        deleteColumnConfirm: [[#{js.warehouse.delete.column.confirm}]],
        deleteColumnSuccess: [[#{js.warehouse.delete.column.success}]],
        deleteColumnFailed: [[#{js.warehouse.delete.column.failed}]],
        deletePositionConfirm: [[#{js.warehouse.delete.position.confirm}]],
        deletePositionSuccess: [[#{js.warehouse.delete.position.success}]],
        deletePositionFailed: [[#{js.warehouse.delete.position.failed}]],
        getWarehouseDetailFailed: [[#{js.warehouse.get.warehouse.detail.failed}]],
        getColumnListFailed: [[#{js.warehouse.get.column.list.failed}]],
        noColumnDataInWarehouse: [[#{js.warehouse.no.column.data.in.warehouse}]],
        calculating: [[#{js.warehouse.calculating}]],
        loadingText: [[#{js.warehouse.loading.text}]],
        totalPositions: [[#{js.warehouse.total.positions}]],
        viewDetails: [[#{js.warehouse.view.details}]],
        editPosition: [[#{js.warehouse.edit.position}]],
        deletePosition: [[#{js.warehouse.delete.position}]],
        exitBatchSelect: [[#{js.warehouse.exit.batch.select}]],
        batchSelect: [[#{js.warehouse.batch.select}]],
        enterBatchModeFirst: [[#{js.warehouse.enter.batch.mode.first}]],
        selectPositionsToModify: [[#{js.warehouse.select.positions.to.modify}]],
        batchUpdateConfirm: [[#{js.warehouse.batch.update.confirm}]],
        batchUpdateReason: [[#{js.warehouse.batch.update.reason}]],
        batchUpdatingStatus: [[#{js.warehouse.batch.updating.status}]],
        batchUpdateSuccess: [[#{js.warehouse.batch.update.success}]],
        noPositionsUpdated: [[#{js.warehouse.no.positions.updated}]],
        batchUpdateFailed: [[#{js.warehouse.batch.update.failed}]],
        statusAvailable: [[#{js.warehouse.status.available}]],
        statusOccupied: [[#{js.warehouse.status.occupied}]],
        statusDisabled: [[#{js.warehouse.status.disabled}]],
        statusUnknown: [[#{js.warehouse.status.unknown}]],
        positionTitleWithVertex: [[#{js.warehouse.position.title.with.vertex}]],
        positionTitleWithoutVertex: [[#{js.warehouse.position.title.without.vertex}]],
        noPositionDataText: [[#{js.warehouse.no.position.data.text}]],
        contextMenuViewDetails: [[#{js.warehouse.context.menu.view.details}]],
        contextMenuEditPosition: [[#{js.warehouse.context.menu.edit.position}]],
        contextMenuDeletePosition: [[#{js.warehouse.context.menu.delete.position}]],
        notAssociated: [[#{js.warehouse.not.associated}]],
        addColumn: [[#{js.warehouse.add.column}]],
        addPosition: [[#{js.warehouse.add.position}]],
        operations: [[#{js.warehouse.operations}]],
        selectWarehouse: [[#{js.warehouse.select.warehouse}]],
        positionPrefix: [[#{js.warehouse.position.prefix}]],
        selectOtherPosition: [[#{js.warehouse.select.other.position}]]
    };
</script>
<script th:src="@{/js/project/warehouse.js}"></script>
</body>
</html>
